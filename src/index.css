@tailwind base;
@tailwind components;
@tailwind utilities;

/* Custom animations for gamification */
@keyframes scoreBonus {
  0% {
    opacity: 1;
    transform: translateX(-50%) translateY(0px) scale(1);
  }
  50% {
    opacity: 1;
    transform: translateX(-50%) translateY(-20px) scale(1.2);
  }
  100% {
    opacity: 0;
    transform: translateX(-50%) translateY(-40px) scale(0.8);
  }
}

@keyframes achievementPulse {
  0%, 100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.05);
  }
}

@keyframes streakFire {
  0%, 100% {
    transform: rotate(-5deg) scale(1);
  }
  50% {
    transform: rotate(5deg) scale(1.1);
  }
}

/* Smooth branch movement animation */
@keyframes branchSlideUp {
  0% {
    transform: translateY(0);
    opacity: 1;
  }
  100% {
    transform: translateY(-20px);
    opacity: 1;
  }
}

.branch-wrapper {
  transition: all 800ms cubic-bezier(0.4, 0, 0.2, 1);
  will-change: transform, opacity;
}

.branch-wrapper.moving {
  animation: branchSlideUp 800ms cubic-bezier(0.4, 0, 0.2, 1);
}

/* Definition of the design system. All colors, gradients, fonts, etc should be defined here. 
All colors MUST be HSL.
*/

@layer base {
  :root {
    /* Japanese-inspired color palette */
    --background: 15 20% 97%;
    --foreground: 240 10% 15%;

    --card: 0 0% 100%;
    --card-foreground: 240 10% 15%;

    --popover: 0 0% 100%;
    --popover-foreground: 240 10% 15%;

    /* Cherry blossom pink as primary */
    --primary: 340 75% 75%;
    --primary-foreground: 0 0% 100%;

    /* Neon yellow as secondary */
    --secondary: 54 100% 62%;
    --secondary-foreground: 240 10% 25%;

    --muted: 60 5% 90%;
    --muted-foreground: 240 5% 45%;

    /* Soft lavender as accent */
    --accent: 260 30% 85%;
    --accent-foreground: 240 10% 25%;

    --destructive: 0 65% 65%;
    --destructive-foreground: 0 0% 100%;

    --border: 240 10% 88%;
    --input: 240 10% 88%;
    --ring: 340 75% 75%;

    /* Game-specific colors */
    --branch: 30 25% 75%;
    --tile: 0 0% 98%;
    --tile-shadow: 240 10% 80%;
    --success: 60 100% 50%;
    --warning: 45 90% 75%;

    /* Gradients */
    --gradient-background: linear-gradient(135deg, hsl(15 20% 97%), hsl(340 20% 95%));
    --gradient-tile: linear-gradient(145deg, hsl(0 0% 100%), hsl(240 5% 95%));
    --gradient-branch: linear-gradient(90deg, hsl(30 25% 75%), hsl(25 20% 70%));

    --radius: 0.75rem;

    --sidebar-background: 0 0% 98%;

    --sidebar-foreground: 240 5.3% 26.1%;

    --sidebar-primary: 240 5.9% 10%;

    --sidebar-primary-foreground: 0 0% 98%;

    --sidebar-accent: 240 4.8% 95.9%;

    --sidebar-accent-foreground: 240 5.9% 10%;

    --sidebar-border: 220 13% 91%;

    --sidebar-ring: 217.2 91.2% 59.8%;
  }

  .dark {
    --background: 222.2 84% 4.9%;
    --foreground: 210 40% 98%;

    --card: 222.2 84% 4.9%;
    --card-foreground: 210 40% 98%;

    --popover: 222.2 84% 4.9%;
    --popover-foreground: 210 40% 98%;

    --primary: 210 40% 98%;
    --primary-foreground: 222.2 47.4% 11.2%;

    --secondary: 217.2 32.6% 17.5%;
    --secondary-foreground: 210 40% 98%;

    --muted: 217.2 32.6% 17.5%;
    --muted-foreground: 215 20.2% 65.1%;

    --accent: 217.2 32.6% 17.5%;
    --accent-foreground: 210 40% 98%;

    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 210 40% 98%;

    --border: 217.2 32.6% 17.5%;
    --input: 217.2 32.6% 17.5%;
    --ring: 212.7 26.8% 83.9%;
    --sidebar-background: 240 5.9% 10%;
    --sidebar-foreground: 240 4.8% 95.9%;
    --sidebar-primary: 224.3 76.3% 48%;
    --sidebar-primary-foreground: 0 0% 100%;
    --sidebar-accent: 240 3.7% 15.9%;
    --sidebar-accent-foreground: 240 4.8% 95.9%;
    --sidebar-border: 240 3.7% 15.9%;
    --sidebar-ring: 217.2 91.2% 59.8%;
  }
}

@layer base {
  * {
    @apply border-border;
  }

  body {
    @apply bg-background text-foreground;
  }
}

/* Audio slider styles */
.slider {
  background: linear-gradient(to right, #8b5cf6 0%, #8b5cf6 var(--value, 30%), #e5e7eb var(--value, 30%), #e5e7eb 100%);
}

.slider::-webkit-slider-thumb {
  appearance: none;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: #8b5cf6;
  cursor: pointer;
  border: 2px solid white;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.slider::-moz-range-thumb {
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: #8b5cf6;
  cursor: pointer;
  border: 2px solid white;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

/* ==========================
   Tile drag/drop micro animations
   ========================== */
.tile-lift {
  transform: translateY(-5px);
  box-shadow: 0 10px 24px rgba(0,0,0,.22);
  will-change: transform, box-shadow;
}

@keyframes tileMicroDrop {
  0% { transform: scale(0.94); }
  60% { transform: scale(1.06); }
  100% { transform: scale(1); }
}
.tile-drop {
  animation: tileMicroDrop 220ms cubic-bezier(.2,.7,.2,1);
  will-change: transform;
}

/* Enameled button style (matches tile material but with white base) */
.btn-enameled {
  background: #ffffff;
  border-radius: 9999px; /* pill */
  border: 1px solid rgba(0,0,0,.08); /* hairline */
  box-shadow:
    inset 0 1px 1px rgba(255,255,255,.25), /* top highlight */
    inset 0 -1px 2px rgba(0,0,0,.06),      /* bottom inner shadow */
    0 2px 8px rgba(0,0,0,.06);            /* soft lift */
  transition: transform 160ms ease, box-shadow 160ms ease, filter 160ms ease;
}
.btn-enameled:hover {
  transform: translateY(-1px);
  box-shadow:
    inset 0 1px 1px rgba(255,255,255,.25),
    inset 0 -1px 2px rgba(0,0,0,.06),
    0 6px 14px rgba(0,0,0,.10);
}
.btn-enameled:active { transform: translateY(0); }

/* Sakura theme — premium, без картинок */
:root{
  --bg-base-1: #FAFAF8;     /* off-white lighter */
  --bg-base-2: #F7F7F4;     /* subtle vertical drift */
  --sakura-1:  #ffc7da;     /* light pink */
  --sakura-2:  #ff9fc3;     /* warm pink */
  --sakura-3:  #b5e3ff;     /* cold bloom */
  --sakura-4:  #c5f2cf;     /* mint bloom */
  --vignette:  rgba(0,0,0,.02);
  --paper-line: rgba(0,0,0,.006);
}

/* База: тёплый градиент + мягкая виньетка */
body.sakura {
  background:
    /* Edge vignette: subtle darkening near edges to focus center */
    radial-gradient(120% 120% at 50% 50%, transparent 60%, rgba(0,0,0,.05) 100%),
    /* Bottom vignette */
    radial-gradient(90% 70% at 50% 120%, var(--vignette) 0%, transparent 55%),
    /* Base paper gradient */
    linear-gradient(180deg, var(--bg-base-1), var(--bg-base-2));
  background-color: var(--bg-base-1);
  position: relative;
  min-height: 100%;
  overflow-x: hidden;
}

/* Бумажная фактура (еле-еле) */
body.sakura::after{
  content:""; position:fixed; inset:0; pointer-events:none; z-index:-1;
  background-image:
    repeating-linear-gradient(0deg,   var(--paper-line) 0 1px, transparent 1px 2px),
    repeating-linear-gradient(90deg,  var(--paper-line) 0 1px, transparent 1px 2px);
  mix-blend-mode:multiply; opacity:.4;  /* итоговая видимость ~4% */
}

/* Угловые «сакура-боке» — 4 мягких пятна по углам */
body.sakura .bg-corners{
  position:fixed; inset:0; pointer-events:none; z-index:-1;
  background:
    radial-gradient(360px 260px at 0%   0%,   color-mix(in srgb, var(--sakura-1) 20%, transparent) 0 70%, transparent 71%),
    radial-gradient(340px 240px at 100% 0%,   color-mix(in srgb, var(--sakura-2) 20%, transparent) 0 70%, transparent 71%),
    radial-gradient(360px 260px at 100% 100%, color-mix(in srgb, var(--sakura-3) 20%, transparent) 0 70%, transparent 71%),
    radial-gradient(340px 240px at 0%   100%, color-mix(in srgb, var(--sakura-4) 20%, transparent) 0 70%, transparent 71%);
  opacity: .75;
  filter: blur(0.3px); /* убирает «полосинг» на ретине */
}

/* Деликатная верхняя вуаль-подсветка */
body.sakura .bg-topglow{
  position:fixed; inset:0; pointer-events:none; z-index:-1;
  background:
    radial-gradient(120% 80% at 50% -20%, rgba(255,255,255,.85) 0%, transparent 60%);
}

/* Дарк (Night Dojo) совместимость — на будущее */
@media (prefers-color-scheme: dark) {
  /* Всегда держим светлую версию Sakura, даже в дарке */
  body.sakura {
    --bg-base-1: #FAFAF8;
    --bg-base-2: #F7F7F4;
    --vignette: rgba(0,0,0,.02);
  }
  body.sakura .bg-corners{
    opacity:.65; /* можно чуть усилить в дарке, но база остаётся светлой */
  }
}

/* Ensure app root doesn't paint over background and content stays above bg layers */
html, #root { background-color: transparent !important; }
#root { position: relative; z-index: 1; }

/* Strong fallback to guarantee light background is applied */
body.sakura { background-color: var(--bg-base-1) !important; }


/* ==========================
   Per-level Sakura modifiers
   ========================== */
/* Common themed layer: use ::before as extra texture layer under content */
body.sakura::before{
  content:""; position:fixed; inset:0; pointer-events:none; z-index:0;
  opacity:.18; /* base opacity, individual themes may override */
}

/* 1) Dots — very thin dotted texture */
body.sakura.theme-dots::before{
  background-image:
    radial-gradient(circle at center, rgba(0,0,0,.12) 1.1px, transparent 1.8px);
  background-size: 16px 16px;
  mix-blend-mode: multiply;
}

/* 2) Grid — fine grid structure */
body.sakura.theme-grid::before{
  opacity:.18;
  background-image:
    repeating-linear-gradient(0deg,   rgba(0,0,0,.08) 0 1px, transparent 1px 11px),
    repeating-linear-gradient(90deg,  rgba(0,0,0,.08) 0 1px, transparent 1px 11px);
  mix-blend-mode: multiply;
}

/* 3) Stripes — subtle vertical guidance */
body.sakura.theme-stripes::before{
  opacity:.16;
  background-image:
    repeating-linear-gradient(90deg, rgba(0,0,0,.10) 0 1px, transparent 1px 16px);
}

/* 4) Rice Paper — fibrous paper texture using noise-like layered gradients */
body.sakura.theme-ricepaper::before{
  opacity:.20;
  background-image:
    radial-gradient(1px 1px at 10% 20%, rgba(0,0,0,.08), transparent 60%),
    radial-gradient(1px 1px at 30% 80%, rgba(0,0,0,.07), transparent 60%),
    radial-gradient(1px 1px at 70% 40%, rgba(0,0,0,.08), transparent 60%),
    radial-gradient(1px 1px at 85% 65%, rgba(0,0,0,.07), transparent 60%);
  background-size: 240px 240px, 210px 210px, 250px 250px, 230px 230px;
  background-blend-mode: multiply;
}

/* 5) Mountains — faint silhouettes on horizon */
body.sakura.theme-mountains::before{
  opacity:.26;
  background:
    /* left foothill */
    radial-gradient(80% 35% at 15% 115%, rgba(0,0,0,.12) 0 60%, transparent 61%),
    /* central massif */
    radial-gradient(90% 40% at 55% 118%, rgba(0,0,0,.11) 0 60%, transparent 61%),
    /* right ridge */
    radial-gradient(70% 30% at 90% 112%, rgba(0,0,0,.10) 0 60%, transparent 61%);
}

/* 6) Sakura branches — very thin strokes from corners */
body.sakura.theme-branches::before{
  opacity:.20;
  background:
    conic-gradient(from 200deg at 0% 0%, color-mix(in srgb, var(--sakura-2) 16%, transparent) 0 10%, transparent 10% 100%),
    conic-gradient(from 20deg  at 100% 0%, color-mix(in srgb, var(--sakura-1) 16%, transparent) 0 10%, transparent 10% 100%),
    conic-gradient(from 200deg at 0% 100%, color-mix(in srgb, var(--sakura-3) 14%, transparent) 0 10%, transparent 10% 100%),
    conic-gradient(from 20deg  at 100% 100%, color-mix(in srgb, var(--sakura-4) 14%, transparent) 0 10%, transparent 10% 100%);
  background-blend-mode: screen;
}

/* 7) Waves — traditional japanese wave arcs (very delicate) */
body.sakura.theme-waves::before{
  opacity:.20;
  background-image:
    radial-gradient(circle at 0 50%, rgba(0,0,0,.10) 2.2px, transparent 2.4px),
    radial-gradient(circle at 10px 50%, rgba(0,0,0,.08) 2.2px, transparent 2.4px);
  background-size: 22px 11px;
  background-position: 0 0, 10px 5px;
  mix-blend-mode: multiply;
}

/* 8) Geometry — subtle hex-like pattern via conic gradients */
body.sakura.theme-geo::before{
  opacity:.18;
  background:
    conic-gradient(from 30deg, rgba(0,0,0,.08) 0 60deg, transparent 60deg 120deg,
                             rgba(0,0,0,.08) 120deg 180deg, transparent 180deg 240deg,
                             rgba(0,0,0,.08) 240deg 300deg, transparent 300deg 360deg);
  background-size: 26px 26px;
}

/* 9) Tsunami — sweeping wave arcs with cool blue tint */
body.sakura.theme-tsunami::before{
  opacity:.22;
  background:
    /* large sweeping arc */
    conic-gradient(from 210deg at 100% 0%, color-mix(in srgb, var(--sakura-3) 16%, transparent) 0 12%, transparent 12% 100%),
    /* counter arc */
    conic-gradient(from 30deg at 0% 100%, color-mix(in srgb, var(--sakura-3) 12%, transparent) 0 10%, transparent 10% 100%),
    /* fine ripples */
    repeating-linear-gradient(135deg, rgba(0,0,0,.06) 0 1px, transparent 1px 14px);
  background-blend-mode: screen, screen, multiply;
}


/* ==========================
   Level-specific overrides
   ========================== */
/* Level 1 — slightly stronger presentation to be clearly noticeable */
body.sakura.level-1 {
  --vignette: rgba(0,0,0,.06);
}
body.sakura.level-1 .bg-corners{
  opacity: .85;
}
/* If level 1 uses ricepaper, make texture a bit denser */
body.sakura.level-1.theme-ricepaper::before{
  opacity:.28;
  background-image:
    radial-gradient(1px 1px at 10% 20%, rgba(0,0,0,.10), transparent 60%),
    radial-gradient(1px 1px at 30% 80%, rgba(0,0,0,.09), transparent 60%),
    radial-gradient(1px 1px at 70% 40%, rgba(0,0,0,.10), transparent 60%),
    radial-gradient(1px 1px at 85% 65%, rgba(0,0,0,.09), transparent 60%);
  background-size: 220px 220px, 200px 200px, 230px 230px, 210px 210px;
}

/* If level 1 uses tsunami, make arc more expressive */
body.sakura.level-1.theme-tsunami::before{
  opacity:.30;
  background:
    conic-gradient(from 210deg at 100% 0%, color-mix(in srgb, var(--sakura-3) 22%, transparent) 0 14%, transparent 14% 100%),
    conic-gradient(from 30deg at 0% 100%, color-mix(in srgb, var(--sakura-3) 18%, transparent) 0 12%, transparent 12% 100%),
    repeating-linear-gradient(135deg, rgba(0,0,0,.08) 0 1px, transparent 1px 12px);
}

/* Level 5 — stronger branches theme presentation */
body.sakura.level-5 {
  --vignette: rgba(0,0,0,.055);
}
body.sakura.level-5 .bg-corners{
  opacity: .82;
}
body.sakura.level-5.theme-branches::before{
  opacity:.26;
  background:
    conic-gradient(from 200deg at 0% 0%, color-mix(in srgb, var(--sakura-2) 20%, transparent) 0 10%, transparent 10% 100%),
    conic-gradient(from 20deg  at 100% 0%, color-mix(in srgb, var(--sakura-1) 20%, transparent) 0 10%, transparent 10% 100%),
    conic-gradient(from 200deg at 0% 100%, color-mix(in srgb, var(--sakura-3) 18%, transparent) 0 10%, transparent 10% 100%),
    conic-gradient(from 20deg  at 100% 100%, color-mix(in srgb, var(--sakura-4) 18%, transparent) 0 10%, transparent 10% 100%);
  background-blend-mode: screen;
}
